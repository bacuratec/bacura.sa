# ููุฎุต ุงูุฅุตูุงุญุงุช ุจุงุณุชุฎุฏุงู MCP Supabase

## โ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุฅุถุงูุฉ ุงูููุงุฑุณ ุงูููููุฏุฉ (Performance)
ุชู ุฅุถุงูุฉ ููุงุฑุณ ุนูู ุฌููุน Foreign Keys ูุชุญุณูู ุงูุฃุฏุงุก:
- โ `attachment_groups.created_by_user_id`
- โ `attachments.group_id` ู `attachments.request_phase_lookup_id`
- โ `notifications.user_id`
- โ `order_ratings.order_id` ู `order_ratings.rated_by_user_id`
- โ `orders.order_status_id`, `orders.provider_id`, `orders.request_id`
- โ `payments.order_id` ู `payments.user_id`
- โ `providers.city_id` ู `providers.entity_type_id`
- โ `refresh_tokens.user_id`
- โ `requesters.city_id` ู `requesters.entity_type_id`
- โ `requests.city_id`, `requests.requester_id`, `requests.service_id`, `requests.status_id`
- โ `tickets.related_order_id`, `tickets.status_id`, `tickets.user_id`

### 2. ุฅุถุงูุฉ RLS Policies (Security)
ุชู ุฅุถุงูุฉ RLS Policies ูุฌููุน ุงูุฌุฏุงูู:

#### ุงูุฌุฏุงูู ุงูุนุงูุฉ:
- โ `partners` - ูุฑุงุกุฉ ุนุงูุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `customers` - ูุฑุงุกุฉ ุนุงูุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `faq_questions` - ูุฑุงุกุฉ ุนุงูุฉ ููุฃุณุฆูุฉ ุงููุดุทุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `services` - ูุฑุงุกุฉ ุนุงูุฉ ููุฎุฏูุงุช ุงููุดุทุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู

#### ุงูุฌุฏุงูู ุงููุฑุชุจุทุฉ ุจุงููุณุชุฎุฏููู:
- โ `requests` - ูุฑุงุกุฉ/ุฅูุดุงุก ูุทุงูุจู ุงูุฎุฏูุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `orders` - ูุฑุงุกุฉ ูุทุงูุจู ุงูุฎุฏูุฉ ูููุฏูู ุงูุฎุฏูุฉ + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `order_ratings` - ูุฑุงุกุฉ ุนุงูุฉ + ุฅูุดุงุก ูููุณุชุฎุฏููู
- โ `tickets` - ูุฑุงุกุฉ/ุฅูุดุงุก ูููุณุชุฎุฏููู + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `notifications` - ูุฑุงุกุฉ/ุชุญุฏูุซ ูููุณุชุฎุฏููู ููุท
- โ `payments` - ูุฑุงุกุฉ/ุฅูุดุงุก ูููุณุชุฎุฏููู + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `profile_infos` - ูุฑุงุกุฉ ุนุงูุฉ + ุฅุฏุงุฑุฉ ูููุณุชุฎุฏููู
- โ `attachments` - ูุฑุงุกุฉ/ุฅูุดุงุก ูููุณุชุฎุฏููู + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `attachment_groups` - ูุฑุงุกุฉ/ุฅูุดุงุก ูููุณุชุฎุฏููู + ุฅุฏุงุฑุฉ ููุฃุฏูู
- โ `refresh_tokens` - ุฅุฏุงุฑุฉ ูููุณุชุฎุฏููู ููุท

#### ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ:
- โ `admins` - ูุฑุงุกุฉ/ุฅุฏุงุฑุฉ ููุฃุฏูู ููุท
- โ `providers` - ูุฑุงุกุฉ ุนุงูุฉ + ุฅุฏุงุฑุฉ ูููุณุชุฎุฏููู ูุงูุฃุฏูู
- โ `requesters` - ูุฑุงุกุฉ/ุฅุฏุงุฑุฉ ูููุณุชุฎุฏููู ูุงูุฃุฏูู

### 3. ุฅุตูุงุญ ูุดุงูู Frontend

#### ุฑูุน ุงูุตูุฑ:
- โ ุฅูุดุงุก `src/utils/imageUpload.js` ููุนุงูุฌุฉ ุฑูุน ุงูุตูุฑ ุฅูู Supabase Storage
- โ ุชุญุฏูุซ `UpsertPartner.jsx` ูุงุณุชุฎุฏุงู ุฑูุน ุงูุตูุฑ ุจุดูู ุตุญูุญ
- โ ุชุญุฏูุซ `UpsertCustomer.jsx` ูุงุณุชุฎุฏุงู ุฑูุน ุงูุตูุฑ ุจุดูู ุตุญูุญ
- โ ุฅุตูุงุญ ูุนุงูุฌุฉ `logo_url` ุจุฏูุงู ูู `imageBase64`

#### ุชุญุณููุงุช:
- โ ุงุณุชุฎุฏุงู `(SELECT auth.uid())` ูู RLS policies ูุชุญุณูู ุงูุฃุฏุงุก
- โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู ูู ุฑูุน ุงูุตูุฑ
- โ ุฅุถุงูุฉ ุงูุชุญูู ูู ููุน ูุญุฌู ุงูููู

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช (Migrations):
1. `fix_missing_indexes_and_rls` - ุฅุถุงูุฉ ุงูููุงุฑุณ ุงูููููุฏุฉ
2. `add_rls_policies_for_all_tables_fixed` - ุฅุถุงูุฉ RLS policies ููุฌุฏุงูู ุงูุนุงูุฉ
3. `add_rls_policies_for_admins_providers_requesters` - ุฅุถุงูุฉ RLS policies ููุฌุฏุงูู ุงูุฃุณุงุณูุฉ

### Frontend:
1. `src/utils/imageUpload.js` - ุฌุฏูุฏ: ุฏูุงู ุฑูุน ุงูุตูุฑ
2. `src/components/admin-components/partners/UpsertPartner.jsx` - ุชุญุฏูุซ ูุนุงูุฌุฉ ุงูุตูุฑ
3. `src/components/admin-components/customers/UpsertCustomer.jsx` - ุชุญุฏูุซ ูุนุงูุฌุฉ ุงูุตูุฑ

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **Supabase Storage**: ุชุฃูุฏ ูู ุฅูุดุงุก bucket ุจุงุณู `images` ูู Supabase Storage
2. **RLS Policies**: ุชู ุงุณุชุฎุฏุงู `(SELECT auth.uid())` ูุชุญุณูู ุงูุฃุฏุงุก ุจุฏูุงู ูู `auth.uid()` ูุจุงุดุฑุฉ
3. **ุฑูุน ุงูุตูุฑ**: ุงูุตูุฑ ุชูุฑูุน ุฅูู `images/partners/` ุฃู `images/customers/` ุญุณุจ ุงูููุน
4. **ุญุฌู ุงูุตูุฑ**: ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ุงูุตูุฑุฉ ูู 5MB

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุฅูุดุงุก Storage Bucket**:
   - ุงุฐูุจ ุฅูู Supabase Dashboard > Storage
   - ุฃูุดุฆ bucket ุฌุฏูุฏ ุจุงุณู `images`
   - ูุนูู Public Access ุฅุฐุง ููุช ุชุฑูุฏ ุงููุตูู ุงูุนุงู ููุตูุฑ

2. **ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช**:
   - ุงุฎุชุจุฑ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู Partners
   - ุงุฎุชุจุฑ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู Customers
   - ุชุฃูุฏ ูู ุนูู ุฑูุน ุงูุตูุฑ ุจุดูู ุตุญูุญ

3. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**:
   - ุฑุงูุจ ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช ุจุนุฏ ุฅุถุงูุฉ ุงูููุงุฑุณ
   - ุชุญูู ูู ุฃู RLS policies ุชุนูู ุจุดูู ุตุญูุญ

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ููุงุฑุณ ูุถุงูุฉ**: 20+ ููุฑุณ
- **RLS Policies ูุถุงูุฉ**: 30+ policy
- **ูููุงุช Frontend ูุนุฏูุฉ**: 3 ูููุงุช
- **ูููุงุช ุฌุฏูุฏุฉ**: 1 ููู (imageUpload.js)

